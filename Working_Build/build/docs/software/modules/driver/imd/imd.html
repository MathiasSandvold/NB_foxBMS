<!-- https://stackoverflow.com/a/53329712 -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.24. Insulation Measurement Device &mdash; foxBMS 2 1.5.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="4.24.1. Bender IR155" href="bender/bender_ir155.html" />
    <link rel="prev" title="4.23. I2C Module" href="../i2c/i2c.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> foxBMS 2
            <img src="../../../../_static/foxbms250px.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/releases.html">1. Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/changelog.html">2. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/motivation.html">3. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/safety/safety.html">4. Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/license.html">5. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/team.html">6. Team</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/abbreviations-definitions.html">1. Abbreviations and Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/naming-conventions.html">2. Naming Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/bms-overview.html">3. The foxBMS 2 Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/use-case.html">4. Use Case</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/getting-started.html">1. Getting Started with foxBMS 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/repository-structure.html">2. Repository Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/software-installation.html">3. Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/workspace.html">4. Creating a Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/first-steps-on-hardware.html">5. First Steps on Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/configuration.html">1. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build/build.html">2. Building the Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/sw-overview.html">3. Software Structure Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../modules.html">4. Software Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../application/algorithm/algorithm.html">4.1. Algorithm Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application/bal/bal.html">4.2. Balancing Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application/bms/bms.html">4.3. BMS Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application/plausibility/plausibility.html">4.4. Plausibility Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application/redundancy/redundancy.html">4.5. Redundancy Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../application/soa/soa.html">4.6. SOA Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/database/database.html">4.7. Database Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/diag/diag.html">4.8. Diagnosis Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/hwinfo/hwinfo.html">4.9. Hardware Info Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/sys/sys.html">4.10. System Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/sys_mon/sys_mon.html">4.11. System Monitoring Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task/ftask/ftask.html">4.12. FTASK Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task/os/os.html">4.13. OS Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adc/adc.html">4.14. ADC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can/can.html">4.15. CAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crc/crc.html">4.16. CRC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contactor/contactor.html">4.17. Contactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dma/dma.html">4.18. DMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../foxmath/foxmath.html">4.19. foxmath</a></li>
<li class="toctree-l2"><a class="reference internal" href="../foxmath/utils.html">4.20. utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fram/fram.html">4.21. FRAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../htsen/htsen.html">4.22. Humidity/Temperature Sensor Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c/i2c.html">4.23. I2C Module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.24. Insulation Measurement Device</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bender/bender_ir155.html">4.24.1. Bender IR155</a></li>
<li class="toctree-l3"><a class="reference internal" href="bender/bender_iso165c.html">4.24.2. Bender iso165c</a></li>
<li class="toctree-l3"><a class="reference internal" href="none/no-imd.html">4.24.3. Dummy Insulation Measurement Device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../interlock/interlock.html">4.25. Interlock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/io.html">4.26. IO Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../meas/meas.html">4.27. Measurement Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mcu/mcu.html">4.28. MCU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../afe/afe.html">4.29. Analog Front-End API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../afe/supported-afes.html">4.30. Supported Analog Front-Ends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pex/pex.html">4.31. Port Expander Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pwm/pwm.html">4.32. PWM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rtc/rtc.html">4.33. RTC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sbc/sbc.html">4.34. SBC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi/spi.html">4.35. SPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sps/sps.html">4.36. SPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ts/ts.html">4.37. Temperature Sensor API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ts/ts-sensors.html">4.38. Supported Temperature Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../main/startup.html">4.39. Embedded Software Startup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../main/version.html">4.40. Version Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../main/fassert.html">4.41. FASSERT Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../unit-tests/unit-tests.html">5. Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build-process/build-process.html">6. Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build-environment/build-environment.html">7. Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/how-to.html">8. How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linker-script/linker-script.html">9. Linker Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/architecture.html">10. Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/overview.html">11. API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/hardware.html">1. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/design-resources.html">2. Design Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/connectors.html">3. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/master.html">4. Master Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/slaves.html">5. Slaves Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/interfaces.html">6. Interfaces Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../system/system-introduction.html">1. System Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../system/system-voltage-and-current-monitoring.html">2. System Voltage And Current Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/dbc.html">1. DBC File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/gui/gui.html">2. foxBMS 2 GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/waf-tools/waf-tools.html">3. Waf Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/debugger/debug-application.html">4. Debugging the Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/halcogen/halcogen.html">5. HALCoGen tool documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/static-analysis/axivion.html">6. Axivion Bauhaus Suite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/style-guide/style-guide.html">2. Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/software-developer-manual.html">3. Software Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/hardware-developer-manual.html">4. Hardware Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/public-release-process.html">5. Public Release Process</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/acknowledgements.html">1. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/indices-and-tables.html">2. Indices and Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/bibliography.html">3. Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">foxBMS 2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../modules.html"><span class="section-number">4. </span>Software Modules</a> &raquo;</li>
      <li><span class="section-number">4.24. </span>Insulation Measurement Device</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/software/modules/driver/imd/imd.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <div class="section" id="insulation-measurement-device">
<span id="id1"></span><h1><span class="section-number">4.24. </span>Insulation Measurement Device<a class="headerlink" href="#insulation-measurement-device" title="Permalink to this headline"></a></h1>
<p>Several different Insulation Measurement Devices (IMD) are supported.</p>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">List of available Insulation Measurement Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bender/bender_ir155.html">4.24.1. Bender IR155</a></li>
<li class="toctree-l1"><a class="reference internal" href="bender/bender_iso165c.html">4.24.2. Bender iso165c</a></li>
<li class="toctree-l1"><a class="reference internal" href="none/no-imd.html">4.24.3. Dummy Insulation Measurement Device</a></li>
</ul>
</div>
<p>A superimposed state machine is implemented that interacts with the actual IMD
implementation. There a different reasons for the state machine to transition
between the states. Generally three cases can happen:</p>
<ul class="simple">
<li><p>an external request to the state machine is received to either initialize
the IMD or to start/stop the insulation resistance measurement</p></li>
<li><p>the IMD implementation request a transition e.g., when the initialization is
finished</p></li>
<li><p>inherent determined transitions e.g., <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_HAS_NEVER_RUN</span></code>
transitions to state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_UNINITIALIZED</span></code></p></li>
</ul>
<p>The state machine consists of the following states:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_HAS_NEVER_RUN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_UNINITIALIZED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_INITIALIZATION</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_IMD_ENABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_SHUTDOWN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_RUNNING</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_ERROR</span></code></p></li>
</ul>
<p>The transitions between the main states of the IMD state machine is depicted
below.</p>
<div class="figure align-default" id="imd-state-diagram">
<div class="graphviz"><img src="../../../../_images/graphviz-ee43084853f5314f2fc3bbe5f78ae426d3414157.png" alt="# Copyright (c) 2010 - 2023, Fraunhofer-Gesellschaft zur Foerderung der angewandten Forschung e.V.
# All rights reserved.
#
# SPDX-License-Identifier: BSD-3-Clause
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
# 1. Redistributions of source code must retain the above copyright notice, this
#    list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright notice,
#    this list of conditions and the following disclaimer in the documentation
#    and/or other materials provided with the distribution.
#
# 3. Neither the name of the copyright holder nor the names of its
#    contributors may be used to endorse or promote products derived from
#    this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# We kindly request you to use one or more of the following phrases to refer to
# foxBMS in your hardware, software, documentation or advertising materials:
#
# - &quot;This product uses parts of foxBMS®&quot;
# - &quot;This product includes parts of foxBMS®&quot;
# - &quot;This product is derived from foxBMS®&quot;

digraph imd_fsm {
    rankdir=TB;
    size=&quot;8,16&quot;
    compound=true;
    node [shape = doublecircle]     nd_initialization
                                    nd_imd_enable;
                                    nd_shutdown;
                                    nd_running;
    node [shape = circle]           nd_never_run
                                    nd_uninitialized
                                    nd_error

    nd_never_run                    [label=&lt;&lt;B&gt;Startup&lt;/B&gt;&gt;];
    nd_uninitialized                [label=&lt;&lt;B&gt;Uninitialized&lt;/B&gt;&gt;];
    nd_initialization               [label=&lt;&lt;B&gt;Initialization &lt;/B&gt;&gt;];
    nd_imd_enable                   [label=&lt;&lt;B&gt;IMD enable&lt;/B&gt;&gt;];
    nd_running                      [label=&lt;&lt;B&gt;Running&lt;/B&gt;&gt;];
    nd_shutdown                     [label=&lt;&lt;B&gt;Shutdown&lt;/B&gt;&gt;];
    nd_error                        [label=&lt;&lt;B&gt;Error&lt;/B&gt;&gt;];

    nd_never_run -&gt; nd_uninitialized
    nd_uninitialized -&gt; nd_initialization  [label=&lt;&lt;B&gt;Request&lt;/B&gt;&gt;];
    nd_initialization -&gt; nd_imd_enable
    nd_initialization -&gt; nd_error
    nd_imd_enable -&gt; nd_running  [label=&lt;&lt;B&gt;Request&lt;/B&gt;&gt;];
    nd_imd_enable -&gt; nd_error
    nd_running -&gt; nd_running
    nd_running -&gt; nd_shutdown  [label=&lt;&lt;B&gt;Request&lt;/B&gt;&gt;];
    nd_running -&gt; nd_error
    nd_shutdown -&gt; nd_imd_enable
    nd_shutdown -&gt; nd_error
}" class="graphviz" /></div>
<p class="caption"><span class="caption-number">Fig. 4.9 </span><span class="caption-text">IMD state flow diagram</span><a class="headerlink" href="#imd-state-diagram" title="Permalink to this image"></a></p>
</div>
<p>These transitions will either be performed automatically or on request. The
following requests can be made to the state machine:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_STATE_INITIALIZE_REQUEST</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_STATE_SWITCH_ON_REQUEST</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IMD_STATE_SHUTDOWN_REQUEST</span></code></p></li>
</ul>
<div class="section" id="brief-state-machine-description">
<h2><span class="section-number">4.24.4. </span>Brief state machine description<a class="headerlink" href="#brief-state-machine-description" title="Permalink to this headline"></a></h2>
<p>The state machine trigger function <code class="docutils literal notranslate"><span class="pre">IMD_Trigger()</span></code> is called periodically
from the 100|_||ms| task.
It starts in state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_HAS_NEVER_RUN</span></code> after startup and
transitions with the next call automatically to state
<code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_UNINITIALIZED</span></code>.
The state machine waits in this state until the
<code class="docutils literal notranslate"><span class="pre">IMD_STATE_INITIALIZE_REQUEST</span></code> has been submitted to the state machine
during the startup phase from the <cite>sys</cite> module.
The state machine transitions to state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_IMD_ENABLE</span></code> after a
successful initialization of the required peripherals and the software modules
of the selected IMD driver implementation in state
<code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_INITIALIZATION</span></code>.
Now, the state machine waits again to receive the
<code class="docutils literal notranslate"><span class="pre">IMD_STATE_SWITCH_ON_REQUEST</span></code> from the application state machine activate the
IMD device and begin with the insulation resistance measurement and the
evaluation of the measurement results from IMD.
The state machine continuously monitors the insulation resistance of the
battery system in this state until the <code class="docutils literal notranslate"><span class="pre">IMD_STATE_SHUTDOWN_REQUEST</span></code> is
submitted to the state machine.
This can be necessary to prevent a mutual interference if multiple insulation
monitoring devices would be monitoring the battery system, e.g., when a vehicle
is connected to a charging station.</p>
</div>
<div class="section" id="description-of-the-imd-state-machine">
<h2><span class="section-number">4.24.5. </span>Description of the IMD state machine<a class="headerlink" href="#description-of-the-imd-state-machine" title="Permalink to this headline"></a></h2>
<p>In the following, the implementations of all cases are explained in detail.</p>
<div class="section" id="imd-fsm-state-has-never-run">
<h3><span class="section-number">4.24.5.1. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_HAS_NEVER_RUN</span></code><a class="headerlink" href="#imd-fsm-state-has-never-run" title="Permalink to this headline"></a></h3>
<p>This is the default state after the startup of the BMS. The state machine will
immediately transition to state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_UNINITIALIZED</span></code> with the next
call.</p>
</div>
<div class="section" id="imd-fsm-state-uninitialized">
<h3><span class="section-number">4.24.5.2. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_UNINITIALIZED</span></code><a class="headerlink" href="#imd-fsm-state-uninitialized" title="Permalink to this headline"></a></h3>
<p>The state machine will wait until an <code class="docutils literal notranslate"><span class="pre">IMD_STATE_INITIALIZE_REQUEST</span></code> is
received.
This request is submitted from the <code class="docutils literal notranslate"><span class="pre">sys</span></code> state machine during the startup
phase of the BMS.</p>
</div>
<div class="section" id="imd-fsm-state-initialization">
<h3><span class="section-number">4.24.5.3. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_INITIALIZATION</span></code><a class="headerlink" href="#imd-fsm-state-initialization" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_INITIALIZATION</span></code> state is responsible to only initialize
the required peripherals and the software module of the selected IMD to prepare
the module for the measurement.
The actual measurement of the IMD shall not be started.
The state machine will switch to <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_ERROR</span></code> in case an error is
detected during the initialization. The interface is utilized using function
<code class="docutils literal notranslate"><span class="pre">IMD_ProcessInitializationState</span></code>.</p>
</div>
<div class="section" id="imd-fsm-state-imd-enable">
<h3><span class="section-number">4.24.5.4. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_IMD_ENABLE</span></code><a class="headerlink" href="#imd-fsm-state-imd-enable" title="Permalink to this headline"></a></h3>
<p>This state is responsible to activate the IMD device and start the insulation
measurement after a successful initialization.
Before this is done, the state request <code class="docutils literal notranslate"><span class="pre">IMD_STATE_SWITCH_ON_REQUEST</span></code> need to
be submitted to the state machine.
In the default software, this will be done by the <code class="docutils literal notranslate"><span class="pre">bms</span></code> state machine during
its initialization phase.
The <code class="docutils literal notranslate"><span class="pre">imd</span></code> state machine will switch to <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_ERROR</span></code> in case an
error is detected during the activation.
The state machine will switch to <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_RUNNING</span></code> once the IMD is
enabled.
The function <code class="docutils literal notranslate"><span class="pre">IMD_ProcessEnableState</span></code> provides the required interface for the
IMD implementation.</p>
</div>
<div class="section" id="imd-fsm-state-shutdown">
<h3><span class="section-number">4.24.5.5. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_SHUTDOWN</span></code><a class="headerlink" href="#imd-fsm-state-shutdown" title="Permalink to this headline"></a></h3>
<p>The insulation measurement and the IMD are switched off in this case using the
interface function <code class="docutils literal notranslate"><span class="pre">IMD_ProcessShutdownState</span></code>.
If this this successful, state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_IMD_ENABLE</span></code> is executed next,
otherwise a transition into state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_ERROR</span></code> will be done.</p>
</div>
<div class="section" id="imd-fsm-state-running">
<h3><span class="section-number">4.24.5.6. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_RUNNING</span></code><a class="headerlink" href="#imd-fsm-state-running" title="Permalink to this headline"></a></h3>
<p>This the main state of the superimposed IMD state machine.
This state acquires the measurement results from the selected IMD implementation
using the function <code class="docutils literal notranslate"><span class="pre">IMD_ProcessRunningState()</span></code> and evaluates the measurement
results in function <code class="docutils literal notranslate"><span class="pre">IMD_EvaluateInsulationMeasurement</span></code>.
This way the evaluation is encapsulated from the insulation measurement
performed by the IMD.
Additionally, the state machine will react on a <code class="docutils literal notranslate"><span class="pre">IMD_STATE_SHUTDOWN_REQUEST</span></code>
request and subsequently switch to state <code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_SHUTDOWN</span></code>.</p>
</div>
<div class="section" id="imd-fsm-state-error">
<h3><span class="section-number">4.24.5.7. </span><code class="docutils literal notranslate"><span class="pre">IMD_FSM_STATE_ERROR</span></code><a class="headerlink" href="#imd-fsm-state-error" title="Permalink to this headline"></a></h3>
<p>This section of the documentation is not yet complete.</p>
</div>
</div>
<div class="section" id="interfaces-for-imd-driver-implementation">
<h2><span class="section-number">4.24.6. </span>Interfaces for IMD driver implementation<a class="headerlink" href="#interfaces-for-imd-driver-implementation" title="Permalink to this headline"></a></h2>
<p>The following functions are used to interface the actual IMD implementation:</p>
<div class="literal-block-wrapper docutils container" id="imd-interface-description">
<div class="code-block-caption"><span class="caption-number">Listing 4.8 </span><span class="caption-text">Interface description for IMD implementations</span><a class="headerlink" href="#imd-interface-description" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/**</span>
<span class="linenos"> 2</span><span class="cm"> * @brief   Processes the initialization state</span>
<span class="linenos"> 3</span><span class="cm"> * @details This function needs to be implemented in the dedicated driver. This</span>
<span class="linenos"> 4</span><span class="cm"> *          function initializes the required SW modules and peripherals but</span>
<span class="linenos"> 5</span><span class="cm"> *          does not start the actual IMD measurement.</span>
<span class="linenos"> 6</span><span class="cm"> * @return  #IMD_FSM_STATE_INITIALIZATION if initialization not fininished and</span>
<span class="linenos"> 7</span><span class="cm"> *          another call is required. #IMD_FSM_STATE_IMD_ENABLE if</span>
<span class="linenos"> 8</span><span class="cm"> *          initialization is finished and #IMD_FSM_STATE_ERROR if an error is</span>
<span class="linenos"> 9</span><span class="cm"> *          detected that prohibits a working IMD driver.</span>
<span class="linenos">10</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">11</span><span class="k">extern</span><span class="w"> </span><span class="n">IMD_FSM_STATES_e</span><span class="w"> </span><span class="nf">IMD_ProcessInitializationState</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="cm">/**</span>
<span class="linenos">14</span><span class="cm"> * @brief   Processes the IMD enable state</span>
<span class="linenos">15</span><span class="cm"> * @details This function needs to be implemented in the dedicated driver. This</span>
<span class="linenos">16</span><span class="cm"> *          function enables the actual IMD device to start the insulation</span>
<span class="linenos">17</span><span class="cm"> *          measurement. Functionality need to be fullfilled after one call.</span>
<span class="linenos">18</span><span class="cm"> * @return  #IMD_FSM_STATE_RUNNING if startup has been completed. Returns #IMD_FSM_STATE_ERROR if an error is</span>
<span class="linenos">19</span><span class="cm"> *          detected that prohibits a working IMD driver.</span>
<span class="linenos">20</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">21</span><span class="k">extern</span><span class="w"> </span><span class="n">IMD_FSM_STATES_e</span><span class="w"> </span><span class="nf">IMD_ProcessEnableState</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="cm">/**</span>
<span class="linenos">24</span><span class="cm"> * @brief   Processes the running state</span>
<span class="linenos">25</span><span class="cm"> * @details This function needs to be implemented in the dedicated driver</span>
<span class="linenos">26</span><span class="cm"> * @param   pTableInsulationMonitoring   pointer to insulation monitoring</span>
<span class="linenos">27</span><span class="cm"> *                                       database entry</span>
<span class="linenos">28</span><span class="cm"> * @return  #IMD_FSM_STATE_RUNNING if measurement works as expected, otherwise</span>
<span class="linenos">29</span><span class="cm"> *          #IMD_FSM_STATE_ERROR if an error is detected that prohibits a</span>
<span class="linenos">30</span><span class="cm"> *          further execution of the IMD driver.</span>
<span class="linenos">31</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">32</span><span class="k">extern</span><span class="w"> </span><span class="n">IMD_FSM_STATES_e</span><span class="w"> </span><span class="nf">IMD_ProcessRunningState</span><span class="p">(</span><span class="n">DATA_BLOCK_INSULATION_MONITORING_s</span><span class="w"> </span><span class="o">*</span><span class="n">pTableInsulationMonitoring</span><span class="p">);</span><span class="w"></span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="cm">/**</span>
<span class="linenos">35</span><span class="cm"> * @brief   Processes the shutdown state</span>
<span class="linenos">36</span><span class="cm"> * @details This function needs to be implemented in the dedicated driver. This</span>
<span class="linenos">37</span><span class="cm"> *          function disables the actual IMD device to stop the insulation</span>
<span class="linenos">38</span><span class="cm"> *          measurement.</span>
<span class="linenos">39</span><span class="cm"> * @return  #IMD_FSM_STATE_SHUTDOWN if shutdown state is not fininished and</span>
<span class="linenos">40</span><span class="cm"> *          another call is required. #IMD_FSM_STATE_IMD_ENABLE if shut down</span>
<span class="linenos">41</span><span class="cm"> *          has been completed and #IMD_FSM_STATE_ERROR if an error is detected</span>
<span class="linenos">42</span><span class="cm"> *          that prohibits a working IMD driver.</span>
<span class="linenos">43</span><span class="cm"> */</span><span class="w"></span>
<span class="linenos">44</span><span class="k">extern</span><span class="w"> </span><span class="n">IMD_FSM_STATES_e</span><span class="w"> </span><span class="nf">IMD_ProcessShutdownState</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
<a href="https://github.com/foxBMS/foxbms-2">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
        src="../../../../_static/forkme.png" alt="Fork me on GitHub">
</a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../i2c/i2c.html" class="btn btn-neutral float-left" title="4.23. I2C Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bender/bender_ir155.html" class="btn btn-neutral float-right" title="4.24.1. Bender IR155" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010 - 2023, Fraunhofer-Gesellschaft zur Foerderung der angewandten Forschung e.V. All rights reserved. See license section for further information.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>