<!-- https://stackoverflow.com/a/53329712 -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8.1.1. How to Use the CAN Module &mdash; foxBMS 2 1.5.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="8.1.2. How to Use the Diagnosis Module" href="../../engine/diag/diag_how-to.html" />
    <link rel="prev" title="8. How-to" href="../../../how-to/how-to.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> foxBMS 2
            <img src="../../../../_static/foxbms250px.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/releases.html">1. Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/changelog.html">2. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/motivation.html">3. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/safety/safety.html">4. Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/license.html">5. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general/team.html">6. Team</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/abbreviations-definitions.html">1. Abbreviations and Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/naming-conventions.html">2. Naming Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/bms-overview.html">3. The foxBMS 2 Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/use-case.html">4. Use Case</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/getting-started.html">1. Getting Started with foxBMS 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/repository-structure.html">2. Repository Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/software-installation.html">3. Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/workspace.html">4. Creating a Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/first-steps-on-hardware.html">5. First Steps on Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/configuration.html">1. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build/build.html">2. Building the Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/sw-overview.html">3. Software Structure Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">4. Software Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unit-tests/unit-tests.html">5. Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build-process/build-process.html">6. Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build-environment/build-environment.html">7. Build Environment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../how-to/how-to.html">8. How-to</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.1.1. How to Use the CAN Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/diag/diag_how-to.html">8.1.2. How to Use the Diagnosis Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../engine/database/database_how-to.html">8.1.3. How to Use the Database Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../task/ftask/ftask_how-to.html">8.1.4. How to Use the FTASK Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../main/fassert_how-to.html">8.1.5. How to Use assertions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../afe/adding-a-new-ic_how-to.html">8.2.1. How to Implement an Analog Front-End Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ts/adding-a-new-ts_how-to.html">8.2.2. How to Implement a New Temperature Sensor Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../developer-manual/style-guide/state-machines_how-to.html">8.2.3. How to Write State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/without-halcogen_how-to.html">8.2.4. How to Use Generated Sources from HALCoGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../unit-tests/unit-tests_how-to.html">8.2.5. How to use unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../unit-tests/unit-tests_how-to.html#guidelines-for-the-unit-test-skeleton">8.2.6. Guidelines for the Unit Test Skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../unit-tests/unit-tests_how-to.html#result">8.2.7. Result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../unit-tests/unit-tests_how-to.html#how-to-exclude-files-from-unit-tests">8.2.8. How to exclude files from unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../unit-tests/unit-tests_how-to.html#using-ceedling-directly">8.2.9. Using ceedling directly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../build-environment/build-environment_how-to.html">8.2.10. Changing and Extending the Build Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../build-process/library-project_how-to.html">8.2.11. How to Build A Library and Link it in a foxBMS 2 Project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../linker-script/linker-script.html">9. Linker Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/architecture.html">10. Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/overview.html">11. API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/hardware.html">1. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/design-resources.html">2. Design Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/connectors.html">3. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/master.html">4. Master Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/slaves.html">5. Slaves Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hardware/interfaces.html">6. Interfaces Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../system/system-introduction.html">1. System Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../system/system-voltage-and-current-monitoring.html">2. System Voltage And Current Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/dbc.html">1. DBC File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/gui/gui.html">2. foxBMS 2 GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/waf-tools/waf-tools.html">3. Waf Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/debugger/debug-application.html">4. Debugging the Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/halcogen/halcogen.html">5. HALCoGen tool documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/static-analysis/axivion.html">6. Axivion Bauhaus Suite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/style-guide/style-guide.html">2. Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/software-developer-manual.html">3. Software Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/hardware-developer-manual.html">4. Hardware Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-manual/public-release-process.html">5. Public Release Process</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/acknowledgements.html">1. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/indices-and-tables.html">2. Indices and Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/bibliography.html">3. Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">foxBMS 2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../how-to/how-to.html"><span class="section-number">8. </span>How-to</a> &raquo;</li>
      <li><span class="section-number">8.1.1. </span>How to Use the CAN Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/software/modules/driver/can/can_how-to.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <div class="section" id="how-to-use-the-can-module">
<span id="id1"></span><h1><span class="section-number">8.1.1. </span>How to Use the CAN Module<a class="headerlink" href="#how-to-use-the-can-module" title="Permalink to this headline"></a></h1>
<div class="section" id="how-to-add-a-new-can-message">
<h2><span class="section-number">8.1.1.1. </span>How to add a new CAN Message<a class="headerlink" href="#how-to-add-a-new-can-message" title="Permalink to this headline"></a></h2>
<ol class="arabic">
<li><p>Add the new CAN message to the symbol file (<code class="docutils literal notranslate"><span class="pre">tools/dbc/foxbms.sym</span></code>).</p>
<ol class="arabic simple">
<li><p>If the message is foxBMS 2 specific prefix it with <code class="docutils literal notranslate"><span class="pre">foxBMS</span></code>.</p></li>
<li><p>Set the DLC</p></li>
<li><p>Add a comment that follows the pattern</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">comment</span> <span class="pre">text</span> <span class="pre">(in&lt;file&gt;:&lt;function&gt;,</span> <span class="pre">fv:tx)</span> <span class="pre">optional</span> <span class="pre">comment</span> <span class="pre">text</span></code>
for files that are transmitted and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">comment</span> <span class="pre">text</span> <span class="pre">(in&lt;file&gt;:&lt;function&gt;,</span> <span class="pre">fv:rx)</span> <span class="pre">optional</span> <span class="pre">comment</span> <span class="pre">text</span></code>
for files that are received as seen by the foxBMS 2 hardware.</p></li>
</ul>
</li>
</ol>
</li>
<li><p>Export the symbol file as dbc file.</p></li>
<li><p>Declare the callback function in</p>
<ul class="simple">
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\tx\can_cbs_tx.h</span></code> for
the transmit callbacks</p></li>
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\rx\can_cbs_rx.h</span></code> for
the receive callbacks</p></li>
</ul>
</li>
<li><p>Implement a callback.
If the message handling suites in any of the existing callback
implementation files (<code class="docutils literal notranslate"><span class="pre">src/app/driver/can/cbs/tx/*</span></code> or respectively
<code class="docutils literal notranslate"><span class="pre">src/app/driver/can/cbs/rx/*</span></code>), implement the callback there, otherwise
create a new file (and accompanying test file) and implement the callback
there.</p></li>
<li><p>Add the message ID and message details:</p>
<ul class="simple">
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx-message-definitions.h</span></code> for
transmit messages</p></li>
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_rx-message-definitions.h</span></code> for
receive messages</p></li>
</ul>
</li>
<li><p>Add the message to the callback array in</p>
<ul class="simple">
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx.c</span></code> for transmit messages in
the array <code class="docutils literal notranslate"><span class="pre">can_txMessages</span></code></p></li>
<li><p>in file <code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_rx.c</span></code> for receive messages in the
array <code class="docutils literal notranslate"><span class="pre">can_rxMessages</span></code></p></li>
</ul>
</li>
<li><p>Verify that the CAN message is defined and implemented as expected by
foxBMS 2 guidelines:</p>
<div class="literal-block-wrapper docutils container" id="can-message-implementation-verification">
<div class="code-block-caption"><span class="caption-number">Listing 8.1 </span><span class="caption-text">Verify CAN message definition and callback implementation</span><a class="headerlink" href="#can-message-implementation-verification" title="Permalink to this code"></a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">C:\Users\vulpes\Documents\foxbms-2&gt;python tests/can/check_ids.py</span>
<span class="go">C:\Users\vulpes\Documents\foxbms-2&gt;python tests/can/check_implemented.py</span>
</pre></div>
</div>
</div>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These script do no syntactical or similar checks of the implementation.
These scripts do text based comparisons in order to help to get a consistent
style for the CAN message implementations.
<strong>The correct implementation etc. must be checked by compiling and debugging.</strong></p>
</div>
<div class="section" id="example-for-a-transmit-message">
<h3><span class="section-number">8.1.1.1.1. </span>Example for a Transmit Message<a class="headerlink" href="#example-for-a-transmit-message" title="Permalink to this headline"></a></h3>
<div class="section" id="creating-the-transmit-message">
<h4><span class="section-number">8.1.1.1.1.1. </span>Creating the Transmit Message<a class="headerlink" href="#creating-the-transmit-message" title="Permalink to this headline"></a></h4>
<p>In this example a message to transmit the foxBMS 2 system status is
implemented.
The name of the message is therefore <code class="docutils literal notranslate"><span class="pre">BmsState</span></code> (following PascalCase naming
convention).
In the symbol file the message is implemented as <code class="docutils literal notranslate"><span class="pre">foxBMS_BmsState</span></code> (prefix
<code class="docutils literal notranslate"><span class="pre">foxBMS</span></code> followed by the message name) with the ID <code class="docutils literal notranslate"><span class="pre">0x220</span></code>.
As the message is transmitted from the point of view of the BMS, the comment in
the symbol file must be
<code class="docutils literal notranslate"><span class="pre">Message</span> <span class="pre">containing</span> <span class="pre">the</span> <span class="pre">foxBMS</span> <span class="pre">system</span> <span class="pre">state</span> <span class="pre">(in:can_cbs_tx_state.c:CANTX_BmsState,</span> <span class="pre">fv:tx)</span></code>.
The new dbc file must be exported.</p>
</div>
<div class="section" id="required-macros">
<h4><span class="section-number">8.1.1.1.1.2. </span>Required Macros<a class="headerlink" href="#required-macros" title="Permalink to this headline"></a></h4>
<p>The name of the macro to be implemented in
<code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx-message-definitions.h</span></code> needs to be prefixed
with <code class="docutils literal notranslate"><span class="pre">CANTX_ID</span></code> (<code class="docutils literal notranslate"><span class="pre">CANTX</span></code> is the module prefix) followed by the message name
in uppercase (<code class="docutils literal notranslate"><span class="pre">BMS_STATE</span></code>), i.e., the full macro name is
<code class="docutils literal notranslate"><span class="pre">CANTX_BMS_STATE_ID</span></code>.
The macro for the period of the transmitted message must be defined: Module
prefix <code class="docutils literal notranslate"><span class="pre">CANTX</span></code> followed by the message name (<code class="docutils literal notranslate"><span class="pre">BMS_STATE</span></code>) and the period in
milliseconds (<code class="docutils literal notranslate"><span class="pre">PERIOD_ms</span></code>), i.e., the full macro name is
<code class="docutils literal notranslate"><span class="pre">CANTX_BMS_STATE_PERIOD_ms</span></code>.
Last, the macro for the phase of the transmitted message must be defined:
Module prefix <code class="docutils literal notranslate"><span class="pre">CANTX</span></code> followed by the message name (<code class="docutils literal notranslate"><span class="pre">BMS_STATE</span></code>) and the
phase in milliseconds (<code class="docutils literal notranslate"><span class="pre">PHASE_ms</span></code>) i.e., the full macro name is
<code class="docutils literal notranslate"><span class="pre">CANTX_BMS_STATE_PHASE_ms</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="adding-the-new-message-id">
<div class="code-block-caption"><span class="caption-number">Listing 8.2 </span><span class="caption-text">Adding the new message ID to the transmit message definition file
<code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx-message-definitions.h</span></code></span><a class="headerlink" href="#adding-the-new-message-id" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/** CAN message properties for BMS state message. Required properties are:</span>
<span class="linenos"> 2</span><span class="cm"> * - Message ID</span>
<span class="linenos"> 3</span><span class="cm"> * - Identifier type (standard or extended)</span>
<span class="linenos"> 4</span><span class="cm"> * - Message period and phase in ms</span>
<span class="linenos"> 5</span><span class="cm"> * - Endianness of message data @{*/</span><span class="w"></span>
<span class="linenos"> 6</span><span class="cp">#define CANTX_BMS_STATE_ID         (0x220u)</span>
<span class="linenos"> 7</span><span class="cp">#define CANTX_BMS_STATE_ID_TYPE    (CAN_STANDARD_IDENTIFIER_11_BIT)</span>
<span class="linenos"> 8</span><span class="cp">#define CANTX_BMS_STATE_PERIOD_ms  (100u)</span>
<span class="linenos"> 9</span><span class="cp">#define CANTX_BMS_STATE_PHASE_ms   (0u)</span>
<span class="linenos">10</span><span class="cp">#define CANTX_BMS_STATE_ENDIANNESS (CAN_BIG_ENDIAN)</span>
<span class="linenos">11</span><span class="cm">/**@}*/</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Now the details of the ID need to be added in an additional macro, that is then
used for the initialization of the transmitted messages macro.
The macro must be named Module prefix (<code class="docutils literal notranslate"><span class="pre">CANTX</span></code>) followed by the message name
(<code class="docutils literal notranslate"><span class="pre">BMS_STATE</span></code>) and suffixed with <code class="docutils literal notranslate"><span class="pre">MESSAGE</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="adding-the-details-to-the-new-message">
<div class="code-block-caption"><span class="caption-number">Listing 8.3 </span><span class="caption-text">Adding the details of the new message ID to the transmit message
definition file
<code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx-message-definitions.h</span></code></span><a class="headerlink" href="#adding-the-details-to-the-new-message" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#define CANTX_BMS_STATE_MESSAGE                                                \</span>
<span class="linenos"> 2</span><span class="cp">    {                                                                          \</span>
<span class="linenos"> 3</span><span class="cp">        .dlc        = CAN_DEFAULT_DLC,                                         \</span>
<span class="linenos"> 4</span><span class="cp">        .id         = CANTX_BMS_STATE_ID,                                      \</span>
<span class="linenos"> 5</span><span class="cp">        .endianness = CANTX_BMS_STATE_ENDIANNESS,                              \</span>
<span class="linenos"> 6</span><span class="cp">        .idType     = CANTX_BMS_STATE_ID_TYPE,                                 \</span>
<span class="linenos"> 7</span><span class="cp">    },                                                                         \</span>
<span class="linenos"> 8</span><span class="cp">    {                                                                          \</span>
<span class="linenos"> 9</span><span class="cp">        .period = CANTX_BMS_STATE_PERIOD_ms, .phase = CANTX_BMS_STATE_PHASE_ms \</span>
<span class="linenos">10</span><span class="cp">    }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="callback-function">
<h4><span class="section-number">8.1.1.1.1.3. </span>Callback Function<a class="headerlink" href="#callback-function" title="Permalink to this headline"></a></h4>
<p>The callback declaration must be done in file
<code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\tx\can_cbs_tx.h</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="callback-declaration">
<div class="code-block-caption"><span class="caption-number">Listing 8.4 </span><span class="caption-text">Declaration of the callback function in
<code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\tx\can_cbs_tx.h</span></code></span><a class="headerlink" href="#callback-declaration" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">extern</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="nf">CANTX_BmsState</span><span class="p">(</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="n">CAN_MESSAGE_PROPERTIES_s</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pCanData</span><span class="p">,</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pMuxId</span><span class="p">,</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">CAN_SHIM_s</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">kpkCanShim</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>The callback definition must be done in the appropriate implementation file,
i.e., for the BMS state message in
<code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\tx\can_cbs_tx_state.c</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="callback-definition">
<div class="code-block-caption"><span class="caption-number">Listing 8.5 </span><span class="caption-text">Definition of the callback function in
<code class="docutils literal notranslate"><span class="pre">src\app\driver\can\cbs\tx\can_cbs_tx_state.c</span></code></span><a class="headerlink" href="#callback-definition" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">extern</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="nf">CANTX_BmsState</span><span class="p">(</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="n">CAN_MESSAGE_PROPERTIES_s</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pCanData</span><span class="p">,</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">pMuxId</span><span class="p">,</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">CAN_SHIM_s</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">kpkCanShim</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="cm">/* Do message handling stuff */</span><span class="w"></span>
<span class="linenos">7</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">8</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="required-variables-adaptations">
<h4><span class="section-number">8.1.1.1.1.4. </span>Required Variables Adaptations<a class="headerlink" href="#required-variables-adaptations" title="Permalink to this headline"></a></h4>
<p>The message needs to be added the transmitted messages array as follows:</p>
<div class="literal-block-wrapper docutils container" id="adding-the-the-new-message-to-the-tx-registry">
<div class="code-block-caption"><span class="caption-number">Listing 8.6 </span><span class="caption-text">Adding the new message to the registry of transmitted messages
<code class="docutils literal notranslate"><span class="pre">src/app/driver/config/can_cfg_tx.c</span></code></span><a class="headerlink" href="#adding-the-the-new-message-to-the-tx-registry" title="Permalink to this code"></a></div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">const</span><span class="w"> </span><span class="n">CAN_TX_MESSAGE_TYPE_s</span><span class="w"> </span><span class="n">can_txMessages</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="cm">/* other messages */</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">{</span><span class="n">CAN_NODE_1</span><span class="p">,</span><span class="w"> </span><span class="n">CANTX_BMS_STATE_MESSAGE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CANTX_BmsState</span><span class="p">,</span><span class="w"> </span><span class="n">NULL_PTR</span><span class="p">},</span><span class="w"> </span><span class="cm">/*!&lt; BMS state */</span><span class="w"></span>
<span class="linenos">4</span><span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="verification">
<h4><span class="section-number">8.1.1.1.1.5. </span>Verification<a class="headerlink" href="#verification" title="Permalink to this headline"></a></h4>
<p>Run the check scripts to verify that the messages are implemented as described
in this how-to’s guidelines.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-number">Listing 8.7 </span><span class="caption-text">Verify CAN transmit message definition and callback implementation</span><a class="headerlink" href="#id2" title="Permalink to this code"></a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">C:\Users\vulpes\Documents\foxbms-2&gt;python tests/can/check_ids.py</span>
<span class="go">C:\Users\vulpes\Documents\foxbms-2&gt;python tests/can/check_implemented.py</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-for-a-receive-message">
<h3><span class="section-number">8.1.1.1.2. </span>Example for a Receive Message<a class="headerlink" href="#example-for-a-receive-message" title="Permalink to this headline"></a></h3>
<p>The implementation of a receive message is done analogous, by replacing <code class="docutils literal notranslate"><span class="pre">tx</span></code>
with <code class="docutils literal notranslate"><span class="pre">rx</span></code> in paths, prefixes, function names etc.</p>
</div>
</div>
<div class="section" id="using-the-can4-interface">
<h2><span class="section-number">8.1.1.2. </span>Using the CAN4 interface<a class="headerlink" href="#using-the-can4-interface" title="Permalink to this headline"></a></h2>
<p>If the CAN Module should be extended to the CAN4 interface, a workaround for a
bug in HALCoGen has to be applied.
For details, please refer to <a class="reference internal" href="../../../../tools/halcogen/halcogen.html#halcogen-tool-documentation"><span class="std std-ref">HALCoGen tool documentation</span></a>.</p>
</div>
<div class="section" id="further-reading">
<h2><span class="section-number">8.1.1.3. </span>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline"></a></h2>
<p>Implementation details of the CAN module are found in <a class="reference internal" href="can.html#can"><span class="std std-ref">CAN</span></a>.</p>
</div>
</div>


           </div>
          </div>
<a href="https://github.com/foxBMS/foxbms-2">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
        src="../../../../_static/forkme.png" alt="Fork me on GitHub">
</a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../../how-to/how-to.html" class="btn btn-neutral float-left" title="8. How-to" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../engine/diag/diag_how-to.html" class="btn btn-neutral float-right" title="8.1.2. How to Use the Diagnosis Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010 - 2023, Fraunhofer-Gesellschaft zur Foerderung der angewandten Forschung e.V. All rights reserved. See license section for further information.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>