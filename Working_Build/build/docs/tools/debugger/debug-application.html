<!-- https://stackoverflow.com/a/53329712 -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Debugging the Application &mdash; foxBMS 2 1.5.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.2.1. Segger Ozone Debugger" href="debugger-ozone.html" />
    <link rel="prev" title="3.1.18. Node Helper" href="../waf-tools/f_node_helper.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> foxBMS 2
            <img src="../../_static/foxbms250px.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general/releases.html">1. Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/changelog.html">2. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/motivation.html">3. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/safety/safety.html">4. Safety</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/license.html">5. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/team.html">6. Team</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/abbreviations-definitions.html">1. Abbreviations and Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/naming-conventions.html">2. Naming Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/bms-overview.html">3. The foxBMS 2 Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/use-case.html">4. Use Case</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/getting-started.html">1. Getting Started with foxBMS 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/repository-structure.html">2. Repository Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/software-installation.html">3. Software Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/workspace.html">4. Creating a Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/first-steps-on-hardware.html">5. First Steps on Hardware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../software/configuration/configuration.html">1. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/build/build.html">2. Building the Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/overview/sw-overview.html">3. Software Structure Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/modules/modules.html">4. Software Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/unit-tests/unit-tests.html">5. Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/build-process/build-process.html">6. Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/build-environment/build-environment.html">7. Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/how-to/how-to.html">8. How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/linker-script/linker-script.html">9. Linker Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/architecture/architecture.html">10. Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/api/overview.html">11. API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/hardware.html">1. Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/design-resources.html">2. Design Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/connectors.html">3. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/master.html">4. Master Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/slaves.html">5. Slaves Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/interfaces.html">6. Interfaces Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../system/system-introduction.html">1. System Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system/system-voltage-and-current-monitoring.html">2. System Voltage And Current Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../dbc.html">1. DBC File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gui/gui.html">2. foxBMS 2 GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../waf-tools/waf-tools.html">3. Waf Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Debugging the Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="debugger-ozone.html">4.2.1. Segger Ozone Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugger-ozone.html#j-flash">4.2.2. J-Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugger-lauterbach.html">4.2.3. Lauterbach Trace32 Debugger</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../halcogen/halcogen.html">5. HALCoGen tool documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static-analysis/axivion.html">6. Axivion Bauhaus Suite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer-manual/preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-manual/style-guide/style-guide.html">2. Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-manual/software-developer-manual.html">3. Software Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-manual/hardware-developer-manual.html">4. Hardware Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-manual/public-release-process.html">5. Public Release Process</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../misc/acknowledgements.html">1. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/indices-and-tables.html">2. Indices and Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/bibliography.html">3. Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">foxBMS 2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">4. </span>Debugging the Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tools/debugger/debug-application.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <div class="section" id="debugging-the-application">
<span id="id1"></span><h1><span class="section-number">4. </span>Debugging the Application<a class="headerlink" href="#debugging-the-application" title="Permalink to this headline"></a></h1>
<p>During development it is necessary to be able to deeply inspect internals
of the BMS application.
This is only possible through a debugger.
Apart from that a debugger is a required tool for downloading code into the BMS.</p>
<p>A debugger attaches to the microcontroller on the BMS which will be called
<cite>target</cite> in the following text. The interface through which the connection
to the target is established is called <cite>JTAG</cite>. The debugger can halt execution
of the program on the target, download register values and restart execution.
Moreover it is possible to mark locations in the code in such a way that the
target will automatically halt once it reaches this location. This is called
a breakpoint.</p>
<p>For more in-depth analysis of program flow it can be necessary to attach a
trace probe to the target. This trace probe is a specialized hardware that
is capable of parsing compressed information that the target can output
through its trace port. This is not necessary for normal debug sessions.</p>
<div class="section" id="how-to-debug">
<h2><span class="section-number">4.1. </span>How to debug<a class="headerlink" href="#how-to-debug" title="Permalink to this headline"></a></h2>
<p>This manual is not able to describe in depth how to debug an application on
an embedded target as this requires education and experience that have to be
obtained through other means.
Nevertheless, this section tries to walk through the main points of debugging
this specific application. As this relies on basic debugger features it should
work with any debugger.</p>
<div class="section" id="software-structure">
<h3><span class="section-number">4.1.1. </span>Software structure<a class="headerlink" href="#software-structure" title="Permalink to this headline"></a></h3>
<p>The main structure of foxBMS 2 are several interacting finite-state machines.
For more information on the system structure please refer to
<a class="reference internal" href="../../software/modules/modules.html#software-modules"><span class="std std-numref">Section 4</span></a> of this documentation.</p>
<p>In order to debug behavior of these state machines it is often helpful to keep
track of the struct that contains the state of the state machine. The state
of a state machine is tracked in a variable that is most of the time called
<code class="docutils literal notranslate"><span class="pre">*_state</span></code>. For details on the anatomy of this style of code please refer to
<a class="reference internal" href="../../developer-manual/style-guide/state-machines_how-to.html#implementation-basics"><span class="std std-numref">Section 8.2.3.2.1</span></a>.</p>
<p>The second central point to look into are the database tables that contain
all values that are passed between state machines. As an example the table
<code class="docutils literal notranslate"><span class="pre">data_blockCellVoltage</span></code> contains the consolidated cell voltages that are
used by the BMS for decisions. For more information on the database refer
to the database documentation in <a class="reference internal" href="../../software/modules/engine/database/database.html#database-module"><span class="std std-numref">Section 4.7</span></a>.</p>
<p>For both of these variable types it can be helpful to monitor them
continuously.
Most debugger know a concept that is often called <cite>watch window</cite>. This watch
window can be configured to monitor and continuously show updates of
certain variables. This way it can be observed which values these variables
take. Please note that even though the updates of a watch window might seem
to be real-time, they are obtained by continuously halting the target and
sampling the registers of the target. That means that firstly the shown
values do not necessarily have to be all values (there might be values
in-between) and secondly showing too many values might impact the performance
of the target depending on the debugger implementation and thus alter real-time
behavior during the debug session.</p>
</div>
<div class="section" id="assertions">
<h3><span class="section-number">4.1.2. </span>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline"></a></h3>
<p>Assertions are a method of ensuring that conditions that are thought to be
true are actually true. foxBMS 2 uses assertions and the standard behavior
is to completely stop the system in case of an assertion. That means that
all interrupts are disabled and the system will come to a halt.</p>
<p>This state can be detected by checking if the system stops and if it does
controlling the value of the struct <code class="docutils literal notranslate"><span class="pre">fas_assertLocation</span></code>. It stores the
program counter and the line number of the location of an assertion that has
failed. The value of the program counter can be used to find the exact
location in code where the assertion has failed.</p>
<p>It is recommended to add the <code class="docutils literal notranslate"><span class="pre">fas_assertLocation</span></code> variable to the watch
window or to set a write breakpoint that trips on writing to this variable in
order to easily see when an assertion has failed.</p>
</div>
<div class="section" id="version-struct">
<h3><span class="section-number">4.1.3. </span>Version struct<a class="headerlink" href="#version-struct" title="Permalink to this headline"></a></h3>
<p>Each binary is automatically marked with the software version from which it
has been built.
The current version is stored in the global variable
<code class="docutils literal notranslate"><span class="pre">ver_foxbmsVersionInformation</span></code> and can be inspected with the debugger.</p>
</div>
</div>
<div class="section" id="choice-of-debugger">
<h2><span class="section-number">4.2. </span>Choice of debugger<a class="headerlink" href="#choice-of-debugger" title="Permalink to this headline"></a></h2>
<p>The choice of the correct debugger depends on many factors and can not be
decided based solely on the information of this manual.
The authors of this manual use and support two types of debuggers. While other
options exist and may yield similar results, we recommend to choose one of
these toolchains if you have to rely on our support for the setup of the
debugger, as we cannot support debugger toolchains that we do not know or
cannot recommend. Feel free to contact us, if you need more information.</p>
<ul class="simple">
<li><p>The first one is the
<a class="reference external" href="https://www.segger.com/j-link-plus.html">Segger J-Link PLUS</a>.
A cheaper debugger solution is the
<a class="reference external" href="https://www.segger.com/jlink_base.html">Segger J-Link BASE</a>.
Please note that the debug software
<a class="reference external" href="https://www.segger.com/products/development-tools/ozone-j-link-debugger/#licensing">Ozone</a>
is not licensed with the base version of J-Link.</p></li>
<li><p>The second type of debugger are the debugger by
<a class="reference external" href="http://www.lauterbach.com">Lauterbach</a>.
The Lauterbach debugger performs under certain conditions better, but is also
more expensive than the J-Link.
Tracing has been tested and set up only with trace-probes by Lauterbach.</p></li>
</ul>
<p>The following sections describe configuration and usage of the debuggers
Segger Ozone and Lauterbach Trace32.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="debugger-ozone.html">4.2.1. Segger Ozone Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugger-ozone.html#j-flash">4.2.2. J-Flash</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugger-lauterbach.html">4.2.3. Lauterbach Trace32 Debugger</a></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
<a href="https://github.com/foxBMS/foxbms-2">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
        src="../../_static/forkme.png" alt="Fork me on GitHub">
</a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../waf-tools/f_node_helper.html" class="btn btn-neutral float-left" title="3.1.18. Node Helper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugger-ozone.html" class="btn btn-neutral float-right" title="4.2.1. Segger Ozone Debugger" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010 - 2023, Fraunhofer-Gesellschaft zur Foerderung der angewandten Forschung e.V. All rights reserved. See license section for further information.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>